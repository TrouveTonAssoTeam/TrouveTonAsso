<%= stylesheet_link_tag 'events', media: 'all' %>
<div class="event-details">
  <% if @event.cover_photo.attached? %>
    <%= image_tag url_for(@event.cover_photo), class: "img-fluid rounded-image" %>
  <% else %>
    <p>Aucune photo de couverture disponible</p>
  <% end %>
  
  <div class="event-header">
    <h1><%= @event.name %></h1>
  </div>

  <div class="event-description">
    <p><strong>Description :</strong> <%= @event.description %></p>
    <p><strong>Date de début :</strong> <%= @event.start_date %></p>
    <p><strong>Date de fin :</strong> <%= @event.end_date %></p>

    <% if @event.participants.any? %>
      <p><strong>Nombre de participants :</strong> <%= @event.participants.count %></p>
    <% else %>
      <p>Aucun participant pour cet événement pour le moment.</p>
    <% end %>
  </div>
   
  <p>Statut de l'événement : <%= @event.status %></p>

  <% if @event.past? && user_signed_in? && current_user.events.include?(@event) %> <!-- Condition pour afficher le formulaire d'avis uniquement si l'utilisateur est inscrit à l'événement -->
    <%= form_with(model: [@event, Review.new], url: create_review_organisation_event_path(@event)) do |form| %>
      <!-- Ajout des champs de nom et prénom -->
      <%= form.label :reviewer_first_name, "Prénom" %>
      <%= form.text_field :reviewer_first_name %>

      <%= form.label :reviewer_last_name, "Nom" %>
      <%= form.text_field :reviewer_last_name %>
      
      <!-- Les autres champs de l'avis -->
      <%= form.label :body %>
      <%= form.text_area :body %>

      <%= form.label :rating %>
      <%= form.number_field :rating, in: 1..5 %>

      <%= form.submit "Créer l'avis" %>
      <br>
    <% end %>
  <% end %>

  <% if @event.reviews.any? %>
    <h2>Avis pour cet événement</h2>
    <ul>
      <% @event.reviews.each do |review| %>
        <li>
          <strong>Description :</strong> <%= review.body %><br>
          <strong>Note :</strong> <%= review.rating %><br>
          <strong>Utilisateur ID :</strong> <%= review.user_id %>
        </li>
      <% end %>
    </ul>
  <% else %>
    <p>Aucun avis disponible pour cet événement pour le moment.</p>
  <% end %>

  <% if @event.past? %> <!-- Condition pour désactiver les liens d'inscription et de désinscription une fois que l'événement est terminé -->
    <% if user_signed_in? %>
      <p>L'événement est clôturé.</p>
    <% end %>
  <% else %>
    <% if user_signed_in? %>
      <% if current_user.events.include?(@event) %>
        <%= link_to 'Se désinscrire', unattend_event_path(@event), data:{turbo_method: :delete}, method: :delete, class: 'btn btn-danger' %>
      <% else %>
        <%= link_to 'S\'inscrire à l\'événement', attend_event_path(@event), class: 'btn btn-primary'%>
      <% end %>
    <% else %>
      <%= link_to 'Se connecter pour s\'inscrire', new_user_session_path, class: 'btn btn-primary' %>
    <% end %>
  <% end %>
</div>
